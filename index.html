<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NICE Prime-Factorization Challenge</title>

  <style>
    :root {
      --bg: #fdfdfd;
      --fg: #111;
      --accent: #0077ff;
      --success: #0a9f00;
      --error: #d0021b;
      --warn: #ff9800;
      --muted: #666;
      --radius: 6px;
      --shadow: 0 2px 8px rgba(0,0,0,.08);
      --font: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--fg);
      margin: 0;
      padding: 2rem 1rem;
      line-height: 1.6;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    h1 { font-size: 2rem; margin: 0 0 .5rem; color: var(--accent); }
    h2 { font-size: 1.4rem; margin: 2rem 0 .5rem; color: var(--accent); }
    h3 { font-size: 1.2rem; margin: 1.5rem 0 .5rem; color: var(--accent); }

    section {
      max-width: 900px;
      margin: 0 auto 2rem;
      padding: 1.5rem;
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    blockquote {
      border-left: 4px solid var(--accent);
      padding-left: 1rem;
      margin: 1rem 0;
      font-style: italic;
      color: var(--muted);
    }

    .note, .warning, .example, .baseline {
      padding: 1rem;
      border-left: 4px solid;
      margin: 1rem 0;
      border-radius: var(--radius);
    }
    .note   { border-color: var(--accent); background: #f0f8ff; }
    .warning{ border-color: var(--warn);   background: #fff3e0; }
    .example{ border-color: var(--success);background: #e8f5e8; }
    .baseline{ border-color: var(--muted);  background: #f8f9fa; }

    label { font-weight: 600; display: block; margin: 1rem 0 .25rem; }
    select, input, button {
      font-size: 1rem;
      padding: .6rem .75rem;
      border: 1px solid #ccc;
      border-radius: var(--radius);
      width: 100%;
      max-width: 320px;
    }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background .2s;
    }
    button:disabled { background: #aaa; cursor: not-allowed; }
    button:not(:disabled):hover { background: #0057cc; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td { padding: .5rem .75rem; border: 1px solid #ddd; text-align: center; }
    th { background: #f4f4f4; }

    #numberDisplay {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 1rem 0;
      background: #eef;
      padding: 1rem;
      border-radius: var(--radius);
      text-align: center;
    }

    #result, #score, #errorInfo {
      margin: .75rem 0;
      font-weight: 600;
    }
    .success { color: var(--success); }
    .error   { color: var(--error); }

    /* Chart */
    #chartContainer {
      margin: 2rem 0;
      text-align: center;
    }
    #chartArea {
      height: 120px;
      display: flex;
      align-items: end;
      justify-content: center;
      border-bottom: 2px solid #333;
      margin: 1rem 0;
    }
    .chart-bar {
      width: 18px;
      margin: 0 2px;
      background: var(--accent);
      transition: height .3s, background .3s;
      border-radius: var(--radius) var(--radius) 0 0;
    }
    .chart-labels {
      font-size: .75rem;
      color: var(--muted);
    }

    /* Hint & Timer */
    .hint-box {
      margin-top: 1rem;
      font-size: .9rem;
      color: var(--muted);
    }
    #timer {
      font-weight: bold;
    }

    /* Responsive */
    @media (min-width: 600px) {
      body { padding: 2rem 4rem; }
      button { width: auto; }
    }
  </style>
</head>
<body>

  <header>
    <h1>NICE Prime-Factorization Challenge</h1>
    <p>Neurophenomenological Integrated Comparative Empiricism</p>
  </header>

  <section>
    <h2>üéØ Purpose</h2>
    <p>This experiment tests whether advanced spiritual or consciousness practices can enable access to non-local information by asking you to mentally factor large semiprime numbers.</p>
    <p><strong>Baseline:</strong> Random chance is effectively 0 % for numbers ‚â• 5 digits.</p>
  </section>

  <section>
    <h2>1. How it works</h2>
    <ol>
      <li>Select digit length (2‚Äì8). <em>Training = 2‚Äì4, Experimental = 5‚Äì6, Advanced = 7‚Äì8.</em></li>
      <li>Click ‚ÄúSummon Number‚Äù. Memorize it.</li>
      <li>Enter the two prime factors separated by a comma.</li>
      <li>Track your success rate and time.</li>
    </ol>
  </section>

  <section>
    <h2>2. Choose difficulty</h2>
    <label for="difficulty">Digits in the number:</label>
    <select id="difficulty">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>
    <button id="summonBtn">Summon Number</button>
  </section>

  <table>
    <thead>
      <tr><th>Digits</th><th>Category</th><th>Human Difficulty</th></tr>
    </thead>
    <tbody>
      <tr><td>2‚Äì4</td><td>Training</td><td>Minutes to hours</td></tr>
      <tr><td>5‚Äì6</td><td>Experimental</td><td>Hours to days</td></tr>
      <tr><td>7‚Äì8</td><td>Advanced</td><td>Weeks to months</td></tr>
    </tbody>
  </table>

  <section id="challengeArea" style="display:none;">
    <h2>3. Factor the number</h2>
    <div id="numberDisplay"></div>
    <label for="factors">Prime factors (comma-separated):</label>
    <input id="factors" type="text" placeholder="e.g. 13,17" autocomplete="off" />
    <button id="checkBtn">Check Answer</button>
    <div id="timer">00:00</div>
    <div id="result"></div>
    <div id="errorInfo"></div>

    <div class="hint-box">
      <button id="hintBtn">Give me a hint</button>
      <span id="hintText"></span>
    </div>
  </section>

  <section>
    <h2>4. Your progress</h2>
    <div id="score">No attempts yet.</div>
    <div id="chartContainer" style="display:none;">
      <h3>Success Rate Over Time</h3>
      <div id="chartArea"></div>
      <div class="chart-labels" id="chartLabels"></div>
    </div>
    <button id="shareBtn" style="display:none;">Share Results</button>
  </section>

  <script>
    /* ---------- Utilities ---------- */
    const isPrime = n => {
      if (n < 2) return false;
      if (n % 2 === 0) return n === 2;
      for (let i = 3; i * i <= n; i += 2) if (n % i === 0) return false;
      return true;
    };

    /* ---------- Data ---------- */
    let current = null;
    let results = JSON.parse(localStorage.getItem('niceResults') || '[]');
    let timerInterval;
    let startTime;

    /* ---------- DOM Shortcuts ---------- */
    const $ = sel => document.querySelector(sel);
    const difficulty = $('#difficulty');
    const summonBtn = $('#summonBtn');
    const challengeArea = $('#challengeArea');
    const numberDisplay = $('#numberDisplay');
    const factorsInput = $('#factors');
    const checkBtn = $('#checkBtn');
    const timer = $('#timer');
    const result = $('#result');
    const errorInfo = $('#errorInfo');
    const score = $('#score');
    const chartContainer = $('#chartContainer');
    const chartArea = $('#chartArea');
    const chartLabels = $('#chartLabels');
    const shareBtn = $('#shareBtn');
    const hintBtn = $('#hintBtn');
    const hintText = $('#hintText');

    /* ---------- Generate Semiprime ---------- */
    function generateComposite(digits) {
      const min = 10 ** (digits - 1);
      const max = 10 ** digits - 1;
      let attempts = 0;
      while (attempts++ < 1e4) {
        const n = min + Math.floor(Math.random() * (max - min + 1));
        if (isPrime(n)) continue;
        for (let i = 2; i * i <= n; ++i) {
          if (n % i === 0) {
            const j = n / i;
            if (Number.isInteger(j) && isPrime(i) && isPrime(j)) {
              return { composite: n, factors: [i, j].sort((a, b) => a - b) };
            }
          }
        }
      }
      // Fallback
      const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97];
      let p1, p2, prod;
      do {
        p1 = primes[Math.floor(Math.random() * primes.length)];
        p2 = primes[Math.floor(Math.random() * primes.length)];
        prod = p1 * p2;
      } while (prod < min || prod > max);
      return { composite: prod, factors: [Math.min(p1, p2), Math.max(p1, p2)] };
    }

    /* ---------- Timer ---------- */
    function startTimer() {
      clearInterval(timerInterval);
      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const m = String(Math.floor(elapsed / 60)).padStart(2, '0');
        const s = String(elapsed % 60).padStart(2, '0');
        timer.textContent = `${m}:${s}`;
      }, 1000);
    }

    /* ---------- Chart ---------- */
    function renderChart() {
      if (!results.length) { chartContainer.style.display = 'none'; return; }
      chartContainer.style.display = 'block';
      chartArea.innerHTML = '';
      chartLabels.innerHTML = '';
      const rates = results.map((_, i) => {
        const correct = results.slice(0, i + 1).filter(r => r.success).length;
        return (correct / (i + 1)) * 100;
      });
      rates.forEach((rate, idx) => {
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = `${rate * 1}px`;
        bar.style.backgroundColor = results[idx].success ? 'var(--success)' : 'var(--error)';
        bar.title = `Attempt ${idx + 1}: ${rate.toFixed(1)} %`;
        chartArea.appendChild(bar);
        const label = document.createElement('span');
        label.textContent = idx + 1;
        label.className = 'chart-label';
        chartLabels.appendChild(label);
      });
    }

    /* ---------- Score ---------- */
    function updateScore() {
      const total = results.length;
      const correct = results.filter(r => r.success).length;
      const rate = total ? (correct / total) * 100 : 0;
      const avgError = total ? (results.reduce((s, r) => s + (r.error || 0), 0) / total).toFixed(1) : 0;
      score.innerHTML = `
        <strong>Attempts:</strong> ${total}<br>
        <strong>Correct:</strong> ${correct}<br>
        <strong>Success Rate:</strong> ${rate.toFixed(1)} %<br>
        <strong>Avg. Error:</strong> ${avgError}<br>
        <strong>Baseline (‚â•5 digits):</strong> random chance ‚âà 0.001 %
      `;
      localStorage.setItem('niceResults', JSON.stringify(results));
      renderChart();
      if (total) shareBtn.style.display = 'inline-block';
    }

    /* ---------- UI Events ---------- */
    summonBtn.addEventListener('click', () => {
      const d = parseInt(difficulty.value);
      current = generateComposite(d);
      numberDisplay.textContent = current.composite;
      challengeArea.style.display = 'block';
      factorsInput.value = '';
      factorsInput.disabled = false;
      checkBtn.disabled = false;
      result.textContent = '';
      errorInfo.textContent = '';
      hintText.textContent = '';
      startTimer();
      factorsInput.focus();
    });

    checkBtn.addEventListener('click', () => {
      if (!current) return;
      const userFactors = factorsInput.value.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n) && n > 0);
      const product = userFactors.reduce((a, b) => a * b, 1);
      const success = userFactors.length === 2 && product === current.composite && userFactors.every(isPrime);
      const error = Math.abs(product - current.composite);
      const time = timer.textContent;
      clearInterval(timerInterval);

      results.push({
        composite: current.composite,
        success,
        error,
        time,
        digits: current.composite.toString().length,
        userFactors,
        correctFactors: current.factors
      });
      updateScore();

      if (success) {
        result.innerHTML = '<span class="success">‚úÖ Correct!</span>';
      } else {
        result.innerHTML = '<span class="error">‚ùå Incorrect.</span>';
        errorInfo.textContent = `Correct factors: ${current.factors.join(' √ó ')} = ${current.composite}`;
      }
      factorsInput.disabled = true;
      checkBtn.disabled = true;
    });

    hintBtn.addEventListener('click', () => {
      if (!current) return;
      const [a, b] = current.factors;
      // Reveal the smaller factor
      hintText.textContent = `Hint: the smaller factor is ${Math.min(a, b)}`;
    });

    shareBtn.addEventListener('click', () => {
      const summary = `NICE Prime Challenge Results:
Attempts: ${results.length}
Correct: ${results.filter(r => r.success).length}
Success rate: ${((results.filter(r => r.success).length / results.length) * 100).toFixed(1)} %`;
      navigator.clipboard.writeText(summary).then(() => alert('Copied to clipboard!')).catch(() => alert(summary));
    });

    factorsInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !checkBtn.disabled) checkBtn.click();
    });

    /* ---------- Init ---------- */
    updateScore();
  </script>
</body>
</html>
