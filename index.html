<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NICE Prime-Factorization Challenge</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: 40px auto; line-height: 1.6; padding: 0 20px; }
    h1 { text-align: center; color: #2c3e50; }
    select, input, button { font-size: 1rem; padding: 0.5em; margin: 0.5em 0; }
    .number-display { font-size: 1.2rem; font-weight: bold; margin-top: 1em; background: #f0f8ff; padding: 15px; border-radius: 5px; }
    .result, .score, .error-info { margin-top: 1em; font-weight: bold; }
    blockquote { border-left: 4px solid #ccc; margin: 1em 0; padding-left: 1em; color: #555; }
    a { color: #2980b9; text-decoration: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    .note { font-size: 0.9em; color: #666; margin-top: 0.5em; }
    .explanation { background: #f9f9f9; padding: 20px; border-radius: 5px; margin: 20px 0; }
    .example { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .warning { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 10px 0; border-left: 4px solid #ffc107; }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .baseline { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
    
    /* Chart Styles */
    .chart-container { 
      width: 100%; 
      height: 400px; 
      border: 1px solid #ddd; 
      margin: 20px 0; 
      padding: 20px; 
      background: #f9f9f9;
      border-radius: 5px;
    }
    .chart-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 15px;
      font-size: 1.1em;
    }
    .chart-area {
      height: 300px;
      position: relative;
      background: white;
      border: 1px solid #ddd;
      border-radius: 3px;
      overflow: hidden;
    }
    .chart-y-axis {
      position: absolute;
      left: 0;
      top: 0;
      width: 60px;
      height: 100%;
      background: #f5f5f5;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px 5px;
      font-size: 0.8em;
    }
    .chart-plot-area {
      position: absolute;
      left: 61px;
      top: 0;
      right: 0;
      bottom: 30px;
      background: white;
    }
    .chart-x-axis {
      position: absolute;
      bottom: 0;
      left: 61px;
      right: 0;
      height: 30px;
      background: #f5f5f5;
      border-top: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
    }
    .chart-point {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 2px solid white;
      box-shadow: 0 0 3px rgba(0,0,0,0.3);
    }
    .chart-point:hover {
      transform: scale(1.5);
      z-index: 10;
    }
    .chart-tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px 8px;
      border-radius: 3px;
      font-size: 0.8em;
      pointer-events: none;
      z-index: 20;
      white-space: nowrap;
    }
    .chart-baseline {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: #ff6b6b;
      opacity: 0.7;
    }
    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
    }
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid #333;
    }
    
    /* Difficulty Colors */
    .difficulty-2 { background-color: #28a745; }
    .difficulty-3 { background-color: #17a2b8; }
    .difficulty-4 { background-color: #007bff; }
    .difficulty-5 { background-color: #ffc107; }
    .difficulty-6 { background-color: #fd7e14; }
    .difficulty-7 { background-color: #dc3545; }
    .difficulty-8 { background-color: #6f42c1; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
      border: 1px solid #e9ecef;
    }
    .stat-number {
      font-size: 1.5em;
      font-weight: bold;
      color: #2c3e50;
    }
    .stat-label {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>NICE Prime-Factorization Challenge</h1>

  <p><strong>Mission:</strong> The <em>NICE</em> project (<strong>Neurophenomenological Integrated Comparative Empiricism</strong>) is a convergent framework and platform that unites first‑person experience (intuitive symbols, insights) with third‑person data (accuracy scores, statistical baselines), allowing practitioners to compare and track progress across spiritual disciplines via a shared, verifiable protocol.</p>
  <p><strong>Aim:</strong> To cultivate inner clarity and outer accountability, mapping real shifts in consciousness and deepening our collective understanding of reality.</p>

  <blockquote>
    "All numbers have a unique set of prime factors… but it's very difficult to do with large numbers."<br>&mdash; Rodriguez
  </blockquote>

  <blockquote>
    "...we want to prove your existence. Here's a very large number. Tell me what the unique prime factors are of this number."<br>&mdash; Andrew (DMTx Podcast) <a href="https://www.youtube.com/watch?v=fDa_iH9R3mw" target="_blank">Watch here</a>
  </blockquote>

  <div class="explanation">
    <h3>🧠 Challenge Difficulty & Mathematical Context</h3>
    <p>Prime factorization becomes exponentially harder as numbers grow larger. The graph shows how close your answers are to the correct solution compared to random chance:</p>
    
    <div class="example">
      <strong>Easy Examples (2-4 digits):</strong><br>
      • 15 = 3 × 5 (trivial)<br>
      • 77 = 7 × 11 (solvable by division)<br>
      • 143 = 11 × 13 (requires systematic checking)<br>
      • 2,021 = 43 × 47 (difficult but doable)
    </div>

    <div class="warning">
      <strong>Computational Impossibility at Scale:</strong><br>
      • 5-digit numbers: ~10,000 possibilities to check<br>
      • 6-digit numbers: ~100,000 possibilities<br>
      • Current cryptography relies on this difficulty (RSA-2048 uses ~600-digit numbers)
    </div>

    <div class="baseline">
      <strong>Statistical Baseline:</strong> Random guessing has essentially 0% success rate for 5+ digit numbers. The graph shows deviation from this baseline - any consistent performance above the red line suggests non-random information access.
    </div>
  </div>

  <h3>Choose Difficulty (by Number Length)</h3>
  <label for="difficulty">Select the number of digits in the challenge number:</label><br>
  <select id="difficulty">
    <option value="2">2 digits (Training)</option>
    <option value="3">3 digits (Training)</option>
    <option value="4">4 digits (Training)</option>
    <option value="5">5 digits (Experimental)</option>
    <option value="6">6 digits (Experimental)</option>
    <option value="7">7 digits (Advanced)</option>
    <option value="8">8 digits (Extreme)</option>
  </select>
  <div class="note">2–4 digits are warm-up; significance starts at 5 digits, where mental factorization becomes practically impossible.</div>
  <button id="summonBtn">Summon Number</button>

  <table>
    <thead><tr><th>Digits</th><th>Category</th><th>Color</th><th>Purpose</th><th>Estimated Difficulty</th></tr></thead>
    <tbody>
      <tr><td>2</td><td>Training</td><td><span class="legend-color difficulty-2"></span></td><td>Build confidence</td><td>Seconds</td></tr>
      <tr><td>3</td><td>Training</td><td><span class="legend-color difficulty-3"></span></td><td>Learn patterns</td><td>Minutes</td></tr>
      <tr><td>4</td><td>Training</td><td><span class="legend-color difficulty-4"></span></td><td>Develop intuition</td><td>Minutes to hours</td></tr>
      <tr><td>5</td><td>Experimental</td><td><span class="legend-color difficulty-5"></span></td><td>Core test</td><td>Hours to days</td></tr>
      <tr><td>6</td><td>Experimental</td><td><span class="legend-color difficulty-6"></span></td><td>Significance threshold</td><td>Days to weeks</td></tr>
      <tr><td>7</td><td>Advanced</td><td><span class="legend-color difficulty-7"></span></td><td>Push limits</td><td>Weeks to months</td></tr>
      <tr><td>8</td><td>Extreme</td><td><span class="legend-color difficulty-8"></span></td><td>Ultimate challenge</td><td>Months to years</td></tr>
    </tbody>
  </table>

  <div class="number-display" id="numberDisplay">Click "Summon Number" to begin</div>
  <label for="factors">Enter prime factors (comma-separated):</label><br>
  <input type="text" id="factors" placeholder="e.g. 13,17" size="30" disabled />
  <button id="checkBtn" disabled>Check Answer</button>

  <div class="result" id="result"></div>
  <div class="error-info" id="errorInfo"></div>

  <div class="stats-grid" id="statsGrid" style="display: none;">
    <div class="stat-card">
      <div class="stat-number" id="totalAttempts">0</div>
      <div class="stat-label">Total Attempts</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="perfectScore">0</div>
      <div class="stat-label">Perfect Scores</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="avgAccuracy">0%</div>
      <div class="stat-label">Avg Accuracy</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="bestAccuracy">0%</div>
      <div class="stat-label">Best Accuracy</div>
    </div>
  </div>

  <div class="chart-container" id="chartContainer" style="display: none;">
    <div class="chart-title">Accuracy vs Attempts (Colored by Difficulty)</div>
    <div class="legend">
      <div class="legend-item"><span class="legend-color difficulty-2"></span> 2-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-3"></span> 3-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-4"></span> 4-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-5"></span> 5-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-6"></span> 6-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-7"></span> 7-digit</div>
      <div class="legend-item"><span class="legend-color difficulty-8"></span> 8-digit</div>
    </div>
    <div class="chart-area">
      <div class="chart-y-axis" id="yAxis"></div>
      <div class="chart-plot-area" id="plotArea"></div>
      <div class="chart-x-axis">Attempt Number</div>
    </div>
    <div class="note">Red line shows random chance baseline. Points above this line suggest non-random information access.</div>
  </div>

  <button id="shareBtn" style="display: none;">Share Results</button>

  <script>
    // Session storage for this page session only
    let sessionResults = [];
    
    function isPrime(n) {
      if (n < 2) return false;
      if (n === 2) return true;
      if (n % 2 === 0) return false;
      for (let i = 3; i <= Math.sqrt(n); i += 2) {
        if (n % i === 0) return false;
      }
      return true;
    }

    function generateComposite(digits) {
      const min = 10 ** (digits - 1);
      const max = 10 ** digits - 1;
      
      // Generate a simple semiprime (product of exactly two primes)
      const primes = [];
      for (let i = 2; i <= Math.sqrt(max); i++) {
        if (isPrime(i)) primes.push(i);
      }
      
      let attempts = 0;
      while (attempts++ < 1000) {
        const p1 = primes[Math.floor(Math.random() * primes.length)];
        const p2 = primes[Math.floor(Math.random() * primes.length)];
        const product = p1 * p2;
        
        if (product >= min && product <= max) {
          return { 
            composite: product, 
            factors: [Math.min(p1, p2), Math.max(p1, p2)],
            digits: digits
          };
        }
      }
      
      // Fallback for very constrained ranges
      const small_primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
      const p1 = small_primes[Math.floor(Math.random() * small_primes.length)];
      const p2 = small_primes[Math.floor(Math.random() * small_primes.length)];
      const product = p1 * p2;
      
      return { 
        composite: product, 
        factors: [Math.min(p1, p2), Math.max(p1, p2)],
        digits: digits
      };
    }

    function calculateAccuracy(userFactors, correctFactors, targetNumber) {
      if (userFactors.length === 0) return 0;
      
      const userProduct = userFactors.reduce((a, b) => a * b, 1);
      const correctProduct = correctFactors.reduce((a, b) => a * b, 1);
      
      // Perfect match
      if (userProduct === correctProduct && 
          JSON.stringify(userFactors.sort()) === JSON.stringify(correctFactors.sort())) {
        return 100;
      }
      
      // Calculate how close the product is to the target
      const error = Math.abs(userProduct - targetNumber);
      const maxError = Math.max(targetNumber, userProduct);
      const proximityScore = Math.max(0, 100 - (error / maxError * 100));
      
      // Bonus for having correct number of factors
      const factorCountBonus = userFactors.length === correctFactors.length ? 10 : 0;
      
      // Bonus for having any correct factors
      const correctFactorBonus = correctFactors.filter(f => userFactors.includes(f)).length * 5;
      
      return Math.min(100, proximityScore + factorCountBonus + correctFactorBonus);
    }

    function updateStats() {
      if (sessionResults.length === 0) {
        document.getElementById('statsGrid').style.display = 'none';
        return;
      }
      
      document.getElementById('statsGrid').style.display = 'grid';
      
      const total = sessionResults.length;
      const perfect = sessionResults.filter(r => r.accuracy === 100).length;
      const avgAccuracy = sessionResults.reduce((sum, r) => sum + r.accuracy, 0) / total;
      const bestAccuracy = Math.max(...sessionResults.map(r => r.accuracy));
      
      document.getElementById('totalAttempts').textContent = total;
      document.getElementById('perfectScore').textContent = perfect;
      document.getElementById('avgAccuracy').textContent = avgAccuracy.toFixed(1) + '%';
      document.getElementById('bestAccuracy').textContent = bestAccuracy.toFixed(1) + '%';
    }

    function renderChart() {
      if (sessionResults.length === 0) {
        document.getElementById('chartContainer').style.display = 'none';
        return;
      }
      
      document.getElementById('chartContainer').style.display = 'block';
      
      const plotArea = document.getElementById('plotArea');
      const yAxis = document.getElementById('yAxis');
      
      // Clear existing content
      plotArea.innerHTML = '';
      yAxis.innerHTML = '';
      
      // Create Y-axis labels
      for (let i = 0; i <= 100; i += 20) {
        const label = document.createElement('div');
        label.textContent = i + '%';
        label.style.textAlign = 'center';
        yAxis.appendChild(label);
      }
      
      // Add baseline line (random chance - essentially 0% for 5+ digits)
      const baseline = document.createElement('div');
      baseline.className = 'chart-baseline';
      baseline.style.bottom = '5%'; // 5% line
      baseline.title = 'Random chance baseline';
      plotArea.appendChild(baseline);
      
      // Plot points
      const plotWidth = plotArea.offsetWidth - 20;
      const plotHeight = plotArea.offsetHeight - 20;
      
      sessionResults.forEach((result, index) => {
        const point = document.createElement('div');
        point.className = `chart-point difficulty-${result.digits}`;
        
        // Position
        const x = (index / Math.max(1, sessionResults.length - 1)) * plotWidth;
        const y = plotHeight - (result.accuracy / 100) * plotHeight;
        
        point.style.left = x + 'px';
        point.style.top = y + 'px';
        
        // Tooltip
        point.addEventListener('mouseenter', (e) => {
          const tooltip = document.createElement('div');
          tooltip.className = 'chart-tooltip';
          tooltip.innerHTML = `
            Attempt ${index + 1}<br>
            ${result.digits}-digit number<br>
            Accuracy: ${result.accuracy.toFixed(1)}%<br>
            Target: ${result.composite}<br>
            Your answer: ${result.userFactors.join(' × ')} = ${result.userProduct}
          `;
          tooltip.style.left = (e.pageX + 10) + 'px';
          tooltip.style.top = (e.pageY - 10) + 'px';
          document.body.appendChild(tooltip);
          
          point.addEventListener('mouseleave', () => {
            document.body.removeChild(tooltip);
          }, { once: true });
        });
        
        plotArea.appendChild(point);
      });
    }

    let currentChallenge = null;
    
    document.getElementById('summonBtn').addEventListener('click', () => {
      const difficulty = parseInt(document.getElementById('difficulty').value);
      currentChallenge = generateComposite(difficulty);
      
      document.getElementById('numberDisplay').innerHTML = 
        `<strong>Number to Factor:</strong> ${currentChallenge.composite} 
         <span style="color: #666;">(${currentChallenge.digits}-digit)</span>`;
      
      document.getElementById('factors').disabled = false;
      document.getElementById('checkBtn').disabled = false;
      document.getElementById('result').textContent = '';
      document.getElementById('errorInfo').textContent = '';
      document.getElementById('factors').value = '';
      document.getElementById('factors').focus();
    });

    document.getElementById('checkBtn').addEventListener('click', () => {
      if (!currentChallenge) return;
      
      const inputStr = document.getElementById('factors').value.trim();
      if (!inputStr) {
        alert('Please enter prime factors!');
        return;
      }
      
      const userFactors = inputStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n) && n > 0);
      
      if (userFactors.length === 0) {
        alert('Please enter valid numbers!');
        return;
      }
      
      const userProduct = userFactors.reduce((a, b) => a * b, 1);
      const accuracy = calculateAccuracy(userFactors, currentChallenge.factors, currentChallenge.composite);
      
      // Store result
      sessionResults.push({
        composite: currentChallenge.composite,
        correctFactors: currentChallenge.factors.slice(),
        userFactors: userFactors.slice(),
        userProduct: userProduct,
        accuracy: accuracy,
        digits: currentChallenge.digits,
        timestamp: new Date().toISOString()
      });
      
      // Display result
      if (accuracy === 100) {
        document.getElementById('result').innerHTML = '<span class="success">✅ Perfect! Exceptional performance!</span>';
      } else if (accuracy > 50) {
        document.getElementById('result').innerHTML = `<span style="color: #ffa500;">⚡ Close! ${accuracy.toFixed(1)}% accuracy</span>`;
      } else {
        document.getElementById('result').innerHTML = `<span class="error">❌ ${accuracy.toFixed(1)}% accuracy</span>`;
      }
      
      const error = Math.abs(userProduct - currentChallenge.composite);
      document.getElementById('errorInfo').innerHTML = `
        <strong>Correct:</strong> ${currentChallenge.factors.join(' × ')} = ${currentChallenge.composite}<br>
        <strong>Your answer:</strong> ${userFactors.join(' × ')} = ${userProduct} (deviation: ${error})
      `;
      
      updateStats();
      renderChart();
      
      document.getElementById('shareBtn').style.display = 'block';
    });

    document.getElementById('shareBtn').addEventListener('click', () => {
      const summary = `NICE Prime Challenge Session Results:\n` +
        `Total attempts: ${sessionResults.length}\n` +
        `Perfect scores: ${sessionResults.filter(r => r.accuracy === 100).length}\n` +
        `Average accuracy: ${(sessionResults.reduce((sum, r) => sum + r.accuracy, 0) / sessionResults.length).toFixed(1)}%\n` +
        `Best accuracy: ${Math.max(...sessionResults.map(r => r.accuracy)).toFixed(1)}%\n\n` +
        `Results by difficulty:\n` +
        [2,3,4,5,6,7,8].map(d => {
          const attempts = sessionResults.filter(r => r.digits === d);
          if (attempts.length === 0) return null;
          const avg = attempts.reduce((sum, r) => sum + r.accuracy, 0) / attempts.length;
          return `${d}-digit: ${attempts.length} attempts, ${avg.toFixed(1)}% avg`;
        }).filter(Boolean).join('\n');
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(summary).then(() => {
          alert('Results copied to clipboard!');
        }).catch(() => {
          alert('Results:\n' + summary);
        });
      } else {
        alert('Results:\n' + summary);
      }
    });

    // Allow Enter key to submit
    document.getElementById('factors').addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !document.getElementById('checkBtn').disabled) {
        document.getElementById('checkBtn').click();
      }
    });
  </script>
</body>
</html>
